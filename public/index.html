<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="EduPay - School Payroll System. Secure login portal for administrators, accountants, and teachers.">
  <title>EduPay | Login</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="login-wrapper">

    <!-- ===== SPACE BACKGROUND ===== -->

    <!-- Star field (28 twinkling stars) -->
    <div class="space-star" style="width:2px;height:2px;top:3%;left:6%;animation:starTwinkle 2.3s ease-in-out infinite 0s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:7%;left:18%;animation:starTwinkle 1.8s ease-in-out infinite 0.5s;"></div>
    <div class="space-star" style="width:3px;height:3px;top:2%;left:34%;animation:starTwinkle 3.1s ease-in-out infinite 1.2s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:11%;left:52%;animation:starTwinkle 2.6s ease-in-out infinite 0.3s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:6%;left:71%;animation:starTwinkle 1.9s ease-in-out infinite 1.8s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:4%;left:87%;animation:starTwinkle 2.8s ease-in-out infinite 0.8s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:15%;left:4%;animation:starTwinkle 3.5s ease-in-out infinite 2.1s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:18%;left:28%;animation:starTwinkle 2.1s ease-in-out infinite 0.6s;"></div>
    <div class="space-star" style="width:3px;height:3px;top:22%;left:44%;animation:starTwinkle 2.9s ease-in-out infinite 1.5s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:14%;left:63%;animation:starTwinkle 1.6s ease-in-out infinite 2.8s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:25%;left:80%;animation:starTwinkle 3.3s ease-in-out infinite 0.2s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:30%;left:12%;animation:starTwinkle 2.0s ease-in-out infinite 1.0s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:35%;left:32%;animation:starTwinkle 2.7s ease-in-out infinite 3.2s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:40%;left:56%;animation:starTwinkle 1.7s ease-in-out infinite 0.7s;"></div>
    <div class="space-star" style="width:3px;height:3px;top:38%;left:74%;animation:starTwinkle 3.8s ease-in-out infinite 2.3s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:45%;left:90%;animation:starTwinkle 2.4s ease-in-out infinite 1.4s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:50%;left:7%;animation:starTwinkle 2.2s ease-in-out infinite 3.5s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:55%;left:23%;animation:starTwinkle 3.0s ease-in-out infinite 0.4s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:60%;left:47%;animation:starTwinkle 2.5s ease-in-out infinite 1.8s;"></div>
    <div class="space-star" style="width:3px;height:3px;top:65%;left:68%;animation:starTwinkle 1.9s ease-in-out infinite 2.6s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:58%;left:86%;animation:starTwinkle 3.4s ease-in-out infinite 0.9s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:70%;left:15%;animation:starTwinkle 2.8s ease-in-out infinite 3.8s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:75%;left:38%;animation:starTwinkle 2.3s ease-in-out infinite 1.1s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:80%;left:60%;animation:starTwinkle 3.6s ease-in-out infinite 2.0s;"></div>
    <div class="space-star" style="width:3px;height:3px;top:72%;left:82%;animation:starTwinkle 1.5s ease-in-out infinite 4.2s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:85%;left:25%;animation:starTwinkle 2.9s ease-in-out infinite 0.3s;"></div>
    <div class="space-star" style="width:2px;height:2px;top:90%;left:50%;animation:starTwinkle 2.1s ease-in-out infinite 1.7s;"></div>
    <div class="space-star" style="width:1px;height:1px;top:88%;left:75%;animation:starTwinkle 3.2s ease-in-out infinite 3.0s;"></div>

    <!-- Asteroids (drift from left to right diagonally) -->
    <div class="asteroid asteroid-a" style="width:45px;height:45px;top:3%;left:-60px;animation:asteroidFly 32s linear infinite 0s;"></div>
    <div class="asteroid asteroid-b" style="width:28px;height:28px;top:18%;left:-40px;animation:asteroidFly 25s linear infinite 5s;"></div>
    <div class="asteroid asteroid-c" style="width:56px;height:56px;top:36%;left:-70px;animation:asteroidFly 40s linear infinite 10s;"></div>
    <div class="asteroid asteroid-d" style="width:20px;height:20px;top:54%;left:-30px;animation:asteroidFly 22s linear infinite 3s;"></div>
    <div class="asteroid asteroid-a" style="width:38px;height:38px;top:70%;left:-55px;animation:asteroidFly 36s linear infinite 16s;"></div>
    <div class="asteroid asteroid-b" style="width:18px;height:18px;top:84%;left:-25px;animation:asteroidFly 20s linear infinite 8s;"></div>
    <div class="asteroid asteroid-c" style="width:44px;height:44px;top:11%;left:-60px;animation:asteroidFly 30s linear infinite 19s;"></div>
    <div class="asteroid asteroid-d" style="width:26px;height:26px;top:62%;left:-35px;animation:asteroidFly 28s linear infinite 13s;"></div>

    <!-- Shooting / wishing stars -->
    <div class="shooting-star" style="width:160px;top:8%;left:-5%;animation:shootingStarFly  3.5s linear infinite 2s;"></div>
    <div class="shooting-star" style="width:180px;top:22%;left:-8%;animation:shootingStarFlyB 5.0s linear infinite 9s;"></div>
    <div class="shooting-star" style="width:140px;top:4%;left:18%;animation:shootingStarFly  3.2s linear infinite 16s;"></div>
    <div class="shooting-star" style="width:200px;top:32%;left:-4%;animation:shootingStarFlyB 4.8s linear infinite 5s;"></div>
    <div class="shooting-star" style="width:150px;top:6%;left:38%;animation:shootingStarFly  4.2s linear infinite 21s;"></div>
    <div class="shooting-star" style="width:170px;top:16%;left:-10%;animation:shootingStarFlyB 3.9s linear infinite 12s;"></div>

    <div class="login-card">
      <div class="login-logo">
        <h1>Edu<span>Pay</span></h1>
        <p>School Payroll System</p>
      </div>
      
      <div id="loginError" class="login-error"></div>
      
      <form id="loginForm" class="login-form" autocomplete="off">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" placeholder="Enter your username" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Enter your password" required>
        </div>
        <button type="submit" id="loginBtn" class="login-btn">Sign In</button>
      </form>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script>
    // Check if already logged in
    const existingUser = getUser();
    if (existingUser && getToken()) {
      redirectToDashboard(existingUser.role);
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      const errorEl = document.getElementById('loginError');
      errorEl.style.display = 'none';

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !password) {
        errorEl.textContent = 'Please enter both username and password.';
        errorEl.style.display = 'block';
        return;
      }

      btn.classList.add('loading');
      btn.innerHTML = '<span class="spinner"></span> Signing in...';

      try {
        const data = await apiRequest('/auth/login', {
          method: 'POST',
          body: { username, password }
        });

        setToken(data.token);
        setUser(data.user);
        redirectToDashboard(data.user.role);
      } catch (err) {
        errorEl.textContent = err.message || 'Login failed. Please try again.';
        errorEl.style.display = 'block';
        btn.classList.remove('loading');
        btn.textContent = 'Sign In';
      }
    });

    function redirectToDashboard(role) {
      switch (role) {
        case 'admin': window.location.href = '/admin'; break;
        case 'accountant': window.location.href = '/accountant'; break;
        case 'teacher': window.location.href = '/teacher-portal'; break;
        default: window.location.href = '/';
      }
    }
  </script>
</body>
</html>
